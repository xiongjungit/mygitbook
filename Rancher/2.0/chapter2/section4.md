##4 - 端口需求
要保证Rancher正常运行，需要主机或者安全策略打开以下端口。使用云服务创建集群(如Amazon EC2或DigitalOcean),Rancher会自动打开这些端口。下图显示了Rancher的基本端口要求。如果需要了解更多，请查阅下表。

![](../image/chapter2/1-2.svg)

###Rancher节点
The following table lists the ports that need to be open to and from nodes that are running the Rancher server container for single node installs or pods for high availability installs.

<table>    <thead>        <tr>          <th>Protocol</th>          <th>Port</th>          <th>Source</th>          <th>Destination</th>          <th>Description</th>        </tr>    </thead>    <tbody>        <tr>          <td>TCP</td>          <td>80</td>          <td>Load Balancer / Reverse Proxy</td>          <td></td>          <td>HTTP traffic to Rancher UI / API.</td>        </tr>        <tr>          <td>TCP</td>          <td>443</td>          <td>Load Balancer / Reverse Proxy<br><br>Otherwise IPs of all cluster nodes and other Rancher API / UI clients.</td>          <td></td>          <td>HTTPS traffic to Rancher UI / API.</td>        </tr>        <tr>                <td>TCP</td>          <td>443</td>          <td></td>          <td>35.160.43.145<br>35.167.242.46<br>52.33.59.17</td>          <td>Rancher catalog (git.rancher.io).</td>        </tr>        <tr>                <td>TCP</td>          <td>22</td>          <td></td>          <td>Any node created using node driver.</td>          <td>SSH provisioning of node by node driver.</td>        </tr>        <tr>                <td>TCP</td>          <td>2376</td>          <td></td>          <td>Any node created using node driver.</td>          <td>Docker daemon TLS port used by node driver.</td>        </tr>        <tr>                <td>TCP</td>          <td>Provider Dependent</td>          <td></td>          <td>Port of the Kubernetes API endpoint in hosted clusters.</td>          <td>Kubernetes API.</td>        </tr>    </tbody></table>



###Kubernetes集群节点
The ports required to be open for cluster nodes changes depending on how the cluster was launched. Each of the tabs below list the ports that need to be opened for different cluster creation options.

> Tip:

> If security isn’t a large concern and you’re okay with opening a few additional ports, you can use the table in Commonly Used Ports as your port reference instead of the comprehensive tables below.

####Node Pools

The following table depicts the port requirements for Rancher Launched Kubernetes with nodes created in an Infrastructure Provider.

> Note:
The required ports are automatically opened by Rancher during creation of clusters in cloud providers like Amazon EC2 or DigitalOcean.

<table style="border-style:solid;">    <thead>        <tr>          <th>From / To</th>          <th>Rancher Nodes</th>          <th>etcd Plane Nodes</th>          <th>Control Plane Nodes</th>          <th>Worker Plane Nodes</th>          <th>External Load Balancer</th>          <th>Internet</th>        </tr>    </thead>    <tbody>        <tr>          <td rowspan="2">Rancher Nodes <sup>(1)</sup></td>          <td></td>          <td colspan="3" style="background-color: #3497DA; color:#ffffff;">22 TCP</td>          <td></td>          <td rowspan="2" style="background-color: #3497DA; color:#ffffff;">git.rancher.io <sup>(2)</sup>:<br>35.160.43.145:32<br>35.167.242.46:32<br>52.33.59.17:32</td>        </tr>        <tr>          <td></td>          <td colspan="3" style="background-color: #3497DA; color:#ffffff;">2376 TCP</td>          <td></td>        </tr>        <tr>          <td rowspan="5">etcd Plane Nodes</td>          <td rowspan="5" style="background-color: #3497DA; color:#ffffff;">443 TCP <sup>(3)</sup></td>          <td style="background-color: #3497DA; color:#ffffff;">2379 TCP</td>          <td></td>          <td></td>          <td rowspan="5" style="background-color: #3497DA; color:#ffffff;">443 TCP</td>          <td></td>        </tr>        <tr>          <td style="background-color: #3497DA; color:#ffffff;">2380 TCP</td>          <td></td>          <td></td>          <td></td>        </tr>        <tr>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">6443 TCP</td>          <td></td>          <td></td>        </tr>        <tr>          <td colspan="3" style="background-color: #3497DA; color:#ffffff;">8472 UDP</td>          <td></td>        </tr>        <tr>          <td style="background-color: #3497DA; color:#ffffff;">9099 TCP <sup>(4)</sup></td>          <td></td>          <td></td>          <td></td>        </tr>        <tr>          <td rowspan="7">Control Plane Nodes</td>          <td rowspan="7" style="background-color: #3497DA; color:#ffffff;">443 TCP <sup>(3)</sup></td>          <td style="background-color: #3497DA; color:#ffffff;">2379 TCP</td>          <td></td>          <td></td>          <td rowspan="7" style="background-color: #3497DA; color:#ffffff;">443 TCP</td>          <td></td>        </tr>        <tr>          <td style="background-color: #3497DA; color:#ffffff;">2380 TCP</td>          <td></td>          <td></td>          <td></td>        </tr>        <tr>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">6443 TCP</td>          <td></td>          <td></td>        </tr>        <tr>          <td colspan="3" style="background-color: #3497DA; color:#ffffff;">8472 UDP</td>          <td></td>        </tr>        <tr>          <td colspan="3" style="background-color: #3497DA; color:#ffffff;">10250 TCP</td>          <td></td>        </tr>        <tr>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">9099 TCP <sup>(4)</sup></td>          <td></td>          <td></td>        </tr>        <tr>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">10254 TCP <sup>(4)</sup></td>          <td></td>          <td></td>        </tr>        <tr>          <td rowspan="4">Worker Plane Nodes</td>          <td rowspan="4" style="background-color: #3497DA; color:#ffffff;">443 TCP <sup>(3)</sup></td>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">6443 TCP</td>          <td></td>          <td rowspan="4" style="background-color: #3497DA; color:#ffffff;">443 TCP</td>          <td></td>        </tr>        <tr>          <td colspan="3" style="background-color: #3497DA; color:#ffffff;">8472 UDP</td>          <td></td>        </tr>        <tr>          <td></td>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">9099 TCP <sup>(4)</sup></td>          <td></td>        </tr>        <tr>          <td></td>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">10254 TCP <sup>(4)</sup></td>          <td></td>        </tr>        <tr>          <td rowspan="2">External Load Balancer <sup>(5)</sup></td>          <td style="background-color: #3497DA; color:#ffffff;">80 TCP</td>          <td></td>          <td></td>          <td></td>          <td></td>          <td></td>        </tr>        <tr>          <td style="background-color: #3497DA; color:#ffffff;">443 TCP <sup>(6)</sup></td>          <td></td>          <td></td>          <td></td>          <td></td>          <td></td>        </tr>        <tr>          <td rowspan="2">API / UI Clients</td>          <td style="background-color: #3497DA; color:#ffffff;">80 TCP <sup>(3)</sup></td>          <td></td>          <td></td>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">80 TCP<br></td>          <td></td>        </tr>        <tr>          <td style="background-color: #3497DA; color:#ffffff;">443 TCP <sup>(3)</sup></td>          <td></td>          <td></td>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">443 TCP</td>          <td></td>        </tr>        <tr>          <td rowspan="3">Workload Clients</td>          <td></td>          <td></td>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">30000-32767 TCP / UDP<br>(nodeport)</td>          <td></td>          <td></td>        </tr>        <tr>          <td></td>          <td></td>          <td colspan="2" style="background-color: #3497DA; color:#ffffff;">80 TCP (Ingress)</td>          <td></td>          <td></td>        </tr>        <tr>          <td></td>          <td></td>          <td colspan="2" style="background-color: #3497DA; color:#ffffff;">443 TCP (Ingress)</td>          <td></td>          <td></td>        </tr>        <tr>          <td colspan="7">Notes:<br><br>1. Nodes running standalone server or Rancher HA deployment.<br>2. Required to fetch Rancher chart library.<br>3. Only without external load balancer.<br>4. Local traffic to the node itself (not across nodes).<br>5. Load balancer / proxy that handles tragging to the Rancher UI / API.<br>6. Only if SSL is not terminated at external load balancer.</td>        </tr>    </tbody></table>

####Custom Nodes

The following table depicts the port requirements for Rancher Launched Kubernetes with Custom Nodes.

<table>    <thead>        <tr>          <th>From / To</th>          <th>Rancher Nodes</th>          <th>etcd Plane Nodes</th>          <th>Control Plane Nodes</th>          <th>Worker Plane Nodes</th>          <th>External Load Balancer</th>          <th>Internet</th>        </tr>    </thead>    <tbody>        <tr>          <td>Rancher Nodes <sup>(1)</sup></td>          <td></td>          <td></td>          <td></td>          <td></td>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">git.rancher.io <sup>(2)</sup>:<br>35.160.43.145:32<br>35.167.242.46:32<br>52.33.59.17:32</td>        </tr>        <tr>          <td rowspan="5">etcd Plane Nodes</td>          <td rowspan="5" style="background-color: #3497DA; color:#ffffff;">443 TCP <sup>(3)</sup></td>          <td style="background-color: #3497DA; color:#ffffff;">2379 TCP</td>          <td></td>          <td></td>          <td rowspan="5" style="background-color: #3497DA; color:#ffffff;">443 TCP</td>          <td></td>        </tr>        <tr>          <td style="background-color: #3497DA; color:#ffffff;">2380 TCP</td>          <td></td>          <td></td>          <td></td>        </tr>        <tr>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">6443 TCP</td>          <td></td>          <td></td>        </tr>        <tr>          <td colspan="3" style="background-color: #3497DA; color:#ffffff;">8472 UDP</td>          <td></td>        </tr>        <tr>          <td style="background-color: #3497DA; color:#ffffff;">9099 TCP <sup>(4)</sup></td>          <td></td>          <td></td>          <td></td>        </tr>        <tr>          <td rowspan="7">Control Plane Nodes</td>          <td rowspan="7" style="background-color: #3497DA; color:#ffffff;">443 TCP <sup>(3)</sup></td>          <td style="background-color: #3497DA; color:#ffffff;">2379 TCP</td>          <td></td>          <td></td>          <td rowspan="7" style="background-color: #3497DA; color:#ffffff;">443 TCP</td>          <td></td>        </tr>        <tr>          <td style="background-color: #3497DA; color:#ffffff;">2380 TCP</td>          <td></td>          <td></td>          <td></td>        </tr>        <tr>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">6443 TCP</td>          <td></td>          <td></td>        </tr>        <tr>          <td colspan="3" style="background-color: #3497DA; color:#ffffff;">8472 UDP</td>          <td></td>        </tr>        <tr>          <td colspan="3" style="background-color: #3497DA; color:#ffffff;">10250 TCP</td>          <td></td>        </tr>        <tr>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">9099 TCP <sup>(4)</sup></td>          <td></td>          <td></td>        </tr>        <tr>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">10254 TCP <sup>(4)</sup></td>          <td></td>          <td></td>        </tr>        <tr>          <td rowspan="4">Worker Plane Nodes</td>          <td rowspan="4" style="background-color: #3497DA; color:#ffffff;">443 TCP <sup>(3)</sup></td>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">6443 TCP</td>          <td></td>          <td rowspan="4" style="background-color: #3497DA; color:#ffffff;">443 TCP</td>          <td></td>        </tr>        <tr>          <td colspan="3" style="background-color: #3497DA; color:#ffffff;">8472 UDP</td>          <td></td>        </tr>        <tr>          <td></td>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">9099 TCP <sup>(4)</sup></td>          <td></td>        </tr>        <tr>          <td></td>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">10254 TCP <sup>(4)</sup></td>          <td></td>        </tr>        <tr>          <td rowspan="2">External Load Balancer <sup>(5)</sup></td>          <td style="background-color: #3497DA; color:#ffffff;">80 TCP</td>          <td></td>          <td></td>          <td></td>          <td></td>          <td></td>        </tr>        <tr>          <td style="background-color: #3497DA; color:#ffffff;">443 TCP <sup>(6)</sup></td>          <td></td>          <td></td>          <td></td>          <td></td>          <td></td>        </tr>        <tr>          <td rowspan="2">API / UI Clients</td>          <td style="background-color: #3497DA; color:#ffffff;">80 TCP <sup>(3)</sup></td>          <td></td>          <td></td>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">80 TCP<br></td>          <td></td>        </tr>        <tr>          <td style="background-color: #3497DA; color:#ffffff;">443 TCP <sup>(3)</sup></td>          <td></td>          <td></td>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">443 TCP</td>          <td></td>        </tr>        <tr>          <td rowspan="3">Workload Clients</td>          <td></td>          <td></td>          <td></td>          <td style="background-color: #3497DA; color:#ffffff;">30000-32767 TCP / UDP<br>(nodeport)</td>          <td></td>          <td></td>        </tr>        <tr>          <td></td>          <td></td>          <td colspan="2" style="background-color: #3497DA; color:#ffffff;">80 TCP (Ingress)</td>          <td></td>          <td></td>        </tr>        <tr>          <td></td>          <td></td>          <td colspan="2" style="background-color: #3497DA; color:#ffffff;">443 TCP (Ingress)</td>          <td></td>          <td></td>        </tr>        <tr>          <td colspan="7">Notes:<br><br>1. Nodes running standalone server or Rancher HA deployment.<br>2. Required to fetch Rancher chart library.<br>3. Only without external load balancer.<br>4. Local traffic to the node itself (not across nodes).<br>5. Load balancer / proxy that handles tragging to the Rancher UI / API.<br>6. Only if SSL is not terminated at external load balancer.</td>        </tr>    </tbody></table>

Hosted Clustes

The following table depicts the port requirements for hosted clusters.

<table>    <thead>        <tr>        <th>From / To</th>        <th>Rancher Nodes</th>        <th>Hosted / Imported Cluster</th>        <th>External Load Balancer</th>        <th>Internet</th>    </tr>    </thead>    <tbody>        <tr>        <td>Rancher Nodes <sup>(1)</sup></td>        <td></td>        <td style="background-color: #3497DA; color:#ffffff;">Kubernetes API <br>Endpoint Port <sup>(2)</sup></td>        <td></td>        <td style="background-color: #3497DA; color:#ffffff;">git.rancher.io <sup>(3)</sup>:<br>35.160.43.145:32<br>35.167.242.46:32<br>52.33.59.17:32</td>        </tr>        <tr>        <td>Hosted / Imported Cluster</td>        <td style="background-color: #3497DA; color:#ffffff;">443 TCP <sup>(4)(5)</sup></td>        <td></td>        <td style="background-color: #3497DA; color:#ffffff;">443 TCP <sup>(5)</sup></td>        <td></td>        </tr>        <tr>        <td>External Load Balancer <sup>(5)</sup></td>        <td style="background-color: #3497DA; color:#ffffff;">80 TCP<br>443 TCP <sup>(6)</sup></td>        <td></td>        <td></td>        <td></td>        </tr>        <tr>        <td>API / UI Clients</td>        <td style="background-color: #3497DA; color:#ffffff;">80 TCP <sup>(4)</sup><br>443 TCP <sup>(4)</sup></td>        <td></td>        <td style="background-color: #3497DA; color:#ffffff;">80 TCP<br>443 TCP</td>        <td></td>        </tr>        <tr>        <td>Workload Client</td>        <td></td>        <td style="background-color: #3497DA; color:#ffffff;">Cluster / Provider Specific <sup>(7)</sup></td>        <td></td>        <td></td>        </tr>        <tr>        <td colspan="5">Notes:<br><br>1. Nodes running standalone server or Rancher HA deployment.<br>2. Only for hosted clusters.<br>3. Required to fetch Rancher chart library.<br>4. Only without external load balancer.<br>5. From worker nodes.<br>6. Only if SSL is not terminated at external load balancer.<br>7. Usually Ingress backed by infrastructure load balancer and/or nodeport.</td>        </tr>    </tbody>  </table>

Imported Clusters

The following table depicts the port requirements for imported clusters.

<table>    <thead>        <tr>        <th>From / To</th>        <th>Rancher Nodes</th>        <th>Hosted / Imported Cluster</th>        <th>External Load Balancer</th>        <th>Internet</th>    </tr>    </thead>    <tbody>        <tr>        <td>Rancher Nodes <sup>(1)</sup></td>        <td></td>        <td style="background-color: #3497DA; color:#ffffff;">Kubernetes API <br>Endpoint Port <sup>(2)</sup></td>        <td></td>        <td style="background-color: #3497DA; color:#ffffff;">git.rancher.io <sup>(3)</sup>:<br>35.160.43.145:32<br>35.167.242.46:32<br>52.33.59.17:32</td>        </tr>        <tr>        <td>Hosted / Imported Cluster</td>        <td style="background-color: #3497DA; color:#ffffff;">443 TCP <sup>(4)(5)</sup></td>        <td></td>        <td style="background-color: #3497DA; color:#ffffff;">443 TCP <sup>(5)</sup></td>        <td></td>        </tr>        <tr>        <td>External Load Balancer <sup>(5)</sup></td>        <td style="background-color: #3497DA; color:#ffffff;">80 TCP<br>443 TCP <sup>(6)</sup></td>        <td></td>        <td></td>        <td></td>        </tr>        <tr>        <td>API / UI Clients</td>        <td style="background-color: #3497DA; color:#ffffff;">80 TCP <sup>(4)</sup><br>443 TCP <sup>(4)</sup></td>        <td></td>        <td style="background-color: #3497DA; color:#ffffff;">80 TCP<br>443 TCP</td>        <td></td>        </tr>        <tr>        <td>Workload Client</td>        <td></td>        <td style="background-color: #3497DA; color:#ffffff;">Cluster / Provider Specific <sup>(7)</sup></td>        <td></td>        <td></td>        </tr>        <tr>        <td colspan="5">Notes:<br><br>1. Nodes running standalone server or Rancher HA deployment.<br>2. Only for hosted clusters.<br>3. Required to fetch Rancher chart library.<br>4. Only without external load balancer.<br>5. From worker nodes.<br>6. Only if SSL is not terminated at external load balancer.<br>7. Usually Ingress backed by infrastructure load balancer and/or nodeport.</td>        </tr>    </tbody>  </table>

###其他端口注意事项

####常用端口
这些端口通常需要在Kubernetes节点上打开，而不管它是什么类型的集群。

<table><thead><tr><th align="center">Protocol</th><th align="center">Port</th><th>Description</th></tr></thead><tbody><tr><td align="center">TCP</td><td align="center">22</td><td>Node driver SSH provisioning</td></tr><tr><td align="center">TCP</td><td align="center">2376</td><td>Node driver Docker daemon TLS port</td></tr><tr><td align="center">TCP</td><td align="center">2379</td><td>etcd client requests</td></tr><tr><td align="center">TCP</td><td align="center">2380</td><td>etcd peer communication</td></tr><tr><td align="center">UDP</td><td align="center">8472</td><td>Canal/Flannel VXLAN overlay networking</td></tr><tr><td align="center">TCP</td><td align="center">9099</td><td>Canal/Flannel livenessProbe/readinessProbe</td></tr><tr><td align="center">TCP</td><td align="center">10250</td><td>kubelet API</td></tr><tr><td align="center">TCP</td><td align="center">10254</td><td>Ingress controller livenessProbe/readinessProbe</td></tr><tr><td align="center">TCP/UDP</td><td align="center">30000-<br>32767</td><td>NodePort port range</td></tr></tbody></table>


###本地节点流量

标记为local traffic的端口(即在上述要求中，Kubernetes healthchecking (livenessProbe andreadinessProbe)使用。 这些healthcheck是在节点本身上执行的。在大多数云环境中，默认情况下允许本地通信。

然而，当以下情况出现时，该流量可能会被阻塞:

节点上应用了严格的主机防火墙策略。
节点具有多个接口(multihomed)。
在这些情况下，您必须在您的主机防火墙中允许这类流量，或者在您的安全组配置中，在公共/私有云托管主机(如AWS或OpenStack)中允许这类流量。

###Rancher AWS EC2安全组
使用AWS EC2 node driver提供Rancher中的集群节点，您可以选择让Rancher创建一个名为rancher-nodes的安全组，以下规则将自动添加到此安全组。

<table><thead><tr><th>Type</th><th align="center">Protocol</th><th align="center">Port Range</th><th>Source/Destination</th><th align="center">Rule Type</th></tr></thead><tbody><tr><td>SSH</td><td align="center">TCP</td><td align="center">22</td><td>0.0.0.0/0</td><td align="center">Inbound</td></tr><tr><td>HTTP</td><td align="center">TCP</td><td align="center">80</td><td>0.0.0.0/0</td><td align="center">Inbound</td></tr><tr><td>Custom TCP Rule</td><td align="center">TCP</td><td align="center">443</td><td>0.0.0.0/0</td><td align="center">Inbound</td></tr><tr><td>Custom TCP Rule</td><td align="center">TCP</td><td align="center">2376</td><td>0.0.0.0/0</td><td align="center">Inbound</td></tr><tr><td>Custom TCP Rule</td><td align="center">TCP</td><td align="center">2379-2380</td><td>sg-xxx (rancher-nodes)</td><td align="center">Inbound</td></tr><tr><td>Custom UDP Rule</td><td align="center">UDP</td><td align="center">4789</td><td>sg-xxx (rancher-nodes)</td><td align="center">Inbound</td></tr><tr><td>Custom TCP Rule</td><td align="center">TCP</td><td align="center">6443</td><td>0.0.0.0/0</td><td align="center">Inbound</td></tr><tr><td>Custom UDP Rule</td><td align="center">UDP</td><td align="center">8472</td><td>sg-xxx (rancher-nodes)</td><td align="center">Inbound</td></tr><tr><td>Custom TCP Rule</td><td align="center">TCP</td><td align="center">10250-10252</td><td>sg-xxx (rancher-nodes)</td><td align="center">Inbound</td></tr><tr><td>Custom TCP Rule</td><td align="center">TCP</td><td align="center">10256</td><td>sg-xxx (rancher-nodes)</td><td align="center">Inbound</td></tr><tr><td>Custom TCP Rule</td><td align="center">TCP</td><td align="center">30000-32767</td><td>30000-32767</td><td align="center">Inbound</td></tr><tr><td>Custom UDP Rule</td><td align="center">UDP</td><td align="center">30000-32767</td><td>30000-32767</td><td align="center">Inbound</td></tr><tr><td>All traffic</td><td align="center">All</td><td align="center">All</td><td>0.0.0.0/0</td><td align="center">Outbound</td></tr></tbody></table>